{"version":3,"file":"index-4066ff15.js","sources":["../../../../../../packages/chords/index.js"],"sourcesContent":["import * as Tone from \"tone\";\n\nconst PITCH_NAME_LIST = [\n  \"C\",\n  \"C#\",\n  \"D\",\n  \"D#\",\n  \"E\",\n  \"F\",\n  \"F#\",\n  \"G\",\n  \"G#\",\n  \"A\",\n  \"A#\",\n  \"B\"\n];\n\nconst TONES_IN_OCTAVE = PITCH_NAME_LIST.length;\nconst BASE_OCTAVE = 4;\n\nconst ROOT = 0;\nconst MINOR_SECOND = 1;\nconst MAJOR_SECOND = 2;\nconst DIMINISHED_THIRD = 2;\nconst MINOR_THIRD = 3;\nconst MAJOR_THIRD = 4;\nconst AUGMENTED_THIRD = 5;\nconst PERFECT_FOURTH = 5;\nconst TRITONE = 6;\nconst PERFECT_FIFTH = 7;\nconst AUGMENTED_FIFTH = 8;\nconst MINOR_SIXTH = 8;\nconst MAJOR_SIXTH = 9;\nconst DIMINISHED_SEVENTH = 9;\nconst MINOR_SEVENTH = 10;\nconst MAJOR_SEVENTH = 11;\nconst MAJOR_NINTH = 14;\nconst MAJOR_ELEVENTH = 17;\n\nexport async function playChord(notes, duration) {\n  if (Tone.context.state !== \"running\") {\n    await Tone.context.resume();\n    await Tone.start();\n  }\n\n  const piano = new Tone.Sampler({\n    baseUrl: \"https://tonejs.github.io/audio/salamander/\",\n    onload: () => {\n      piano.triggerAttackRelease(\n        notes.map((note) => `${note}${BASE_OCTAVE}`),\n        duration\n      );\n    },\n    urls: {\n      A4: \"A4.mp3\",\n      C4: \"C4.mp3\",\n      \"D#4\": \"Ds4.mp3\",\n      \"F#4\": \"Fs4.mp3\"\n    }\n  }).toDestination();\n}\n\nexport function parseChord(chordString) {\n  const [root, shape] = [getChordRoot(chordString), getChordShape(chordString)];\n\n  return shape.map((offset) => {\n    const scaleDegree = root + offset;\n    return PITCH_NAME_LIST[scaleDegree % TONES_IN_OCTAVE];\n  });\n}\n\nfunction getChordRoot(symbol) {\n  const [mainDegree, modifierDegree] = symbol\n    .split(\"/\")\n    .map((chord) =>\n      getScaleInterval(chord.match(/([b#]?[iI]{0,2}[vV]?[iI]{0,2})/)[1])\n    );\n\n  if (typeof mainDegree !== \"number\") throw new Error();\n\n  return (mainDegree + (modifierDegree ?? 0)) % TONES_IN_OCTAVE;\n}\n\nfunction getChordShape(symbol) {\n  let shape;\n\n  if (symbol.match(/dim|m7b5/)) {\n    shape = [ROOT, MINOR_THIRD, TRITONE, TONES_IN_OCTAVE];\n  } else if (symbol.match(/aug|\\+/)) {\n    shape = [ROOT, MAJOR_THIRD, AUGMENTED_FIFTH, TONES_IN_OCTAVE];\n  } else if (\n    symbol.toLowerCase() === symbol ||\n    (symbol.match(/m|min/) && !symbol.match(\"maj\"))\n  ) {\n    shape = [ROOT, MINOR_THIRD, PERFECT_FIFTH, TONES_IN_OCTAVE];\n  } else {\n    // assume major triad\n    shape = [ROOT, MAJOR_THIRD, PERFECT_FIFTH, TONES_IN_OCTAVE];\n  }\n\n  if (symbol.match(\"sus2\")) {\n    shape[1] = DIMINISHED_THIRD;\n  } else if (symbol.match(\"sus4\")) {\n    shape[1] = AUGMENTED_THIRD;\n  }\n\n  if (symbol.match(\"M7\")) {\n    shape[3] = MAJOR_SEVENTH;\n  } else if (symbol.match(\"dim7\")) {\n    shape[3] = DIMINISHED_SEVENTH;\n  } else if (symbol.match(\"7\")) {\n    shape[3] = MINOR_SEVENTH;\n  }\n\n  if (symbol.match(\"add9\")) {\n    shape.push(MAJOR_NINTH);\n  }\n\n  if (symbol.match(\"add11\")) {\n    shape.push(MAJOR_ELEVENTH);\n  }\n\n  return shape;\n}\n\nfunction getScaleInterval(symbol) {\n  switch (symbol) {\n    case \"#vii\":\n    case \"#VII\":\n    case \"i\":\n    case \"I\":\n      return ROOT;\n    case \"#i\":\n    case \"#I\":\n    case \"bii\":\n    case \"bII\":\n      return MINOR_SECOND;\n    case \"ii\":\n    case \"II\":\n      return MAJOR_SECOND;\n    case \"#ii\":\n    case \"#II\":\n    case \"biii\":\n    case \"bIII\":\n      return MINOR_THIRD;\n    case \"iii\":\n    case \"III\":\n    case \"biv\":\n    case \"bIV\":\n      return MAJOR_THIRD;\n    case \"#iii\":\n    case \"#III\":\n    case \"iv\":\n    case \"IV\":\n      return PERFECT_FOURTH;\n    case \"#iv\":\n    case \"#IV\":\n    case \"bv\":\n    case \"bV\":\n      return TRITONE;\n    case \"v\":\n    case \"V\":\n      return PERFECT_FIFTH;\n    case \"#v\":\n    case \"#V\":\n    case \"bvi\":\n    case \"bVI\":\n      return MINOR_SIXTH;\n    case \"vi\":\n    case \"VI\":\n      return MAJOR_SIXTH;\n    case \"#vi\":\n    case \"#VI\":\n    case \"bvii\":\n    case \"bVII\":\n      return MINOR_SEVENTH;\n    case \"vii\":\n    case \"VII\":\n    case \"bi\":\n    case \"bI\":\n      return MAJOR_SEVENTH;\n    default:\n      throw new RangeError();\n  }\n}\n"],"names":[],"mappings":"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"}